<!DOCTYPE html>
<html>
<head>
    <title>PayHere Final Debug - Field Validation Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-form { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #28a745; }
        button { background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #218838; }
        .progress { background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #28a745; }
        .field-info { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 5px 0; border-left: 4px solid #ffc107; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        td { padding: 8px; border: 1px solid #ddd; }
        .field-name { font-weight: bold; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>PayHere Final Debug - Field Validation Fix</h1>
    
    <div class="progress">
        <h3>🚀 Excellent Progress!</h3>
        <p><strong>Hash Issue:</strong> ✅ SOLVED</p>
        <p><strong>Previous Errors:</strong> 081916062526 → 301916062522/518/512 → 361916062508/351916062557</p>
        <p><strong>Current Issue:</strong> Field validation (phone/email format)</p>
        <p>We're very close to success! 🎯</p>
    </div>
    
    <div class="field-info">
        <h3>🔍 Error Code Analysis:</h3>
        <ul>
            <li><strong>361916062508:</strong> Likely phone number format issue</li>
            <li><strong>351916062557:</strong> Likely email format or field length issue</li>
        </ul>
    </div>
    
    <h2>🧪 Test 1: Standard Sri Lankan Phone Format</h2>
    
    <div class="test-form">
        <h3>Using Standard Sri Lankan Phone Format (+94xxxxxxxxx)</h3>
        <table>
            <tr><td class="field-name">phone</td><td>+94771234567</td></tr>
            <tr><td class="field-name">email</td><td>test@example.com</td></tr>
            <tr><td class="field-name">address</td><td>123 Main Street</td></tr>
            <tr><td class="field-name">city</td><td>Colombo</td></tr>
        </table>
        
        <form method="POST" action="https://sandbox.payhere.lk/pay/checkout">
            <input type="hidden" name="merchant_id" value="4OVxzM0PLRQ4JFnJecjqk43Xi">
            <input type="hidden" name="return_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="cancel_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="notify_url" value="https://httpbin.org/post">
            <input type="hidden" name="order_id" value="PHONE_TEST_1750082700000">
            <input type="hidden" name="items" value="Test Payment">
            <input type="hidden" name="currency" value="LKR">
            <input type="hidden" name="amount" value="100.00">
            <input type="hidden" name="first_name" value="John">
            <input type="hidden" name="last_name" value="Doe">
            <input type="hidden" name="email" value="test@example.com">
            <input type="hidden" name="phone" value="+94771234567">
            <input type="hidden" name="address" value="123 Main Street">
            <input type="hidden" name="city" value="Colombo">
            <input type="hidden" name="country" value="Sri Lanka">
            <input type="hidden" name="hash" value="38e2db249838480ed7761d717df7fa51">
            
            <button type="submit">🧪 Test +94 Phone Format</button>
        </form>
    </div>
    
    <h2>🧪 Test 2: Local Phone Format</h2>
    
    <div class="test-form">
        <h3>Using Local Phone Format (0xxxxxxxxx)</h3>
        <table>
            <tr><td class="field-name">phone</td><td>0771234567</td></tr>
            <tr><td class="field-name">email</td><td>user@gmail.com</td></tr>
            <tr><td class="field-name">address</td><td>Colombo</td></tr>
            <tr><td class="field-name">city</td><td>Colombo</td></tr>
        </table>
        
        <form method="POST" action="https://sandbox.payhere.lk/pay/checkout">
            <input type="hidden" name="merchant_id" value="4OVxzM0PLRQ4JFnJecjqk43Xi">
            <input type="hidden" name="return_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="cancel_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="notify_url" value="https://httpbin.org/post">
            <input type="hidden" name="order_id" value="LOCAL_TEST_1750082700001">
            <input type="hidden" name="items" value="Test Payment">
            <input type="hidden" name="currency" value="LKR">
            <input type="hidden" name="amount" value="100.00">
            <input type="hidden" name="first_name" value="John">
            <input type="hidden" name="last_name" value="Doe">
            <input type="hidden" name="email" value="user@gmail.com">
            <input type="hidden" name="phone" value="0771234567">
            <input type="hidden" name="address" value="Colombo">
            <input type="hidden" name="city" value="Colombo">
            <input type="hidden" name="country" value="Sri Lanka">
            <input type="hidden" name="hash" value="7ff9502c7e40150b5cb5302351c994d7">
            
            <button type="submit">🧪 Test 0xx Phone Format</button>
        </form>
    </div>
    
    <h2>🧪 Test 3: Minimal Fields Only</h2>
    
    <div class="test-form">
        <h3>Only Absolutely Required Fields (No phone/address)</h3>
        
        <form method="POST" action="https://sandbox.payhere.lk/pay/checkout">
            <input type="hidden" name="merchant_id" value="4OVxzM0PLRQ4JFnJecjqk43Xi">
            <input type="hidden" name="return_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="cancel_url" value="https://httpbin.org/status/200">
            <input type="hidden" name="notify_url" value="https://httpbin.org/post">
            <input type="hidden" name="order_id" value="MINIMAL_TEST_1750082700002">
            <input type="hidden" name="items" value="Test Payment">
            <input type="hidden" name="currency" value="LKR">
            <input type="hidden" name="amount" value="100.00">
            <input type="hidden" name="first_name" value="John">
            <input type="hidden" name="last_name" value="Doe">
            <input type="hidden" name="email" value="test@test.com">
            <input type="hidden" name="hash" value="398dc683ab66431aa79eeceab29e7694">
            
            <button type="submit">🧪 Test Minimal Fields</button>
        </form>
    </div>
    
    <div class="progress">
        <h3>🎯 What We're Testing:</h3>
        <ol>
            <li><strong>Phone Format:</strong> +94 vs 0xx format</li>
            <li><strong>Email Format:</strong> Different email providers</li>
            <li><strong>Required Fields:</strong> What's actually required vs optional</li>
            <li><strong>Field Length:</strong> Shorter vs longer values</li>
        </ol>
        
        <h3>📊 Expected Results:</h3>
        <ul>
            <li>✅ <strong>Success:</strong> Payment page loads</li>
            <li>🔄 <strong>Different Error:</strong> New error code (more progress)</li>
            <li>❌ <strong>Same Error:</strong> Still have validation issues</li>
        </ul>
    </div>
    
    <div class="field-info">
        <h3>🔧 Once We Find the Working Format:</h3>
        <ol>
            <li>✅ Update PayHere service to use lowercase hash</li>
            <li>✅ Fix field validation in wallet deposit form</li>
            <li>✅ Test end-to-end wallet deposit flow</li>
            <li>✅ Restore proper notify URLs for your app</li>
        </ol>
    </div>
</body>
</html>
